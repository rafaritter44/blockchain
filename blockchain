type bloco = {hash:string, hashanterior:string, dados:string};

fun gethash ({hash=h, hashanterior=_, dados=_} : bloco) = h;

fun gethashanterior ({hash=_, hashanterior=ha, dados=_} : bloco) = ha;

fun getdados ({hash=_, hashanterior=_, dados=d} : bloco) = d;

type cadeia = bloco list;

fun criabloco (hash:string, dados:string, []) = 
let
	val hashanterior = ""
in
	{hash, hashanterior, dados}:bloco
end
  | criabloco (hash:string, dados:string, c::cs:cadeia) = 
let
	val hashanterior = gethash c
in
	{hash, hashanterior, dados}:bloco
end;

fun add (b:bloco, []) = [b]
  | add (b:bloco, c:cadeia) = b::c;

fun gerahash (hashanterior, dados) = hashanterior ^ dados;

fun isvalido [] = true
  | isvalido (c::[]) =
let
	val hashanterior = gethashanterior c
	val hash = gethash c
	val hashanteriorreal = ""
	val hashreal = gerahash (hashanteriorreal, getdados c)
in
	hashanterior = hashanteriorreal
	andalso hash = hashreal
end
  | isvalido (c::ca::cs) =
let
	val hashanterior = gethashanterior c
	val hash = gethash c
	val hashanteriorreal = gethash ca
	val hashreal = gerahash (hashanteriorreal, getdados c)
in
	hashanterior = hashanteriorreal
	andalso hash = hashreal
	andalso isvalido (ca::cs)
end;